<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fragment+Mono:ital@0;1&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <title>quick sketch</title>
    <style>
        html, body {
          margin: 0;
          padding: 0;
          overflow: hidden;
          background: #fff;
        }
      </style>
</head>

<body>
  <div class="button-group" id="sketch-controls">
    <button id="clearBtn">Clear</button>
    <button id="saveBtn">Save</button>
  </div>
  <canvas id="drawingCanvas"></canvas>

  <script>
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    const clearBtn = document.getElementById('clearBtn');
    const saveBtn = document.getElementById('saveBtn');

    let drawing = false;
    let lastPos = null;

    function resizeCanvas() {
      const ratio = window.devicePixelRatio || 1;
      canvas.width = window.innerWidth * ratio;
      canvas.height = window.innerHeight * ratio;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.scale(ratio, ratio);
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.lineWidth = 3;
      ctx.strokeStyle = '#000';
    }

    window.addEventListener('resize', () => {
      resizeCanvas();
    });

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function getPos(e) {
      if (e.touches && e.touches.length > 0) {
        return { x: e.touches[0].clientX, y: e.touches[0].clientY };
      } else {
        return { x: e.offsetX, y: e.offsetY };
      }
    }

    function drawLine(from, to) {
      ctx.beginPath();
      ctx.moveTo(from.x, from.y);
      ctx.lineTo(to.x, to.y);
      ctx.stroke();
    }

    canvas.addEventListener('mousedown', (e) => {
      drawing = true;
      lastPos = getPos(e);
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!drawing) return;
      const currentPos = getPos(e);
      drawLine(lastPos, currentPos);
      lastPos = currentPos;
    });

    canvas.addEventListener('mouseup', () => {
      drawing = false;
    });

    canvas.addEventListener('mouseleave', () => {
      drawing = false;
    });

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      drawing = true;
      lastPos = getPos(e);
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (!drawing) return;
      const currentPos = getPos(e);
      drawLine(lastPos, currentPos);
      lastPos = currentPos;
    });

    canvas.addEventListener('touchend', () => {
      drawing = false;
    });

    clearBtn.addEventListener('click', () => {
      clearCanvas();
    });

    saveBtn.addEventListener('click', () => {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');

        const timestamp = `${year}-${month}-${day}-${hours}-${minutes}-${seconds}`;
        const filename = `quick-sketch-${timestamp}.png`;

        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL();
        link.click();
     });

    resizeCanvas();
  </script>
</body>
</html>
